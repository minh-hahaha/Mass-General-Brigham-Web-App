// This is your Prisma schema file, learn more about it in the docs: https://pris.ly/d/prisma-schema
// To push the databases from here to Postgres, use "yarn workspace database push"

generator client {
  provider   = "prisma-client-js"
  output     = "../.prisma/client"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

// Example table used in the express router example
model Score {
  id    Int      @id @default(autoincrement())
  time  DateTime
  score Int
}

model Employee {
  id             Int              @id @default(autoincrement())
  first_name     String
  middle_name    String?
  last_name      String
  position       String
  date_hired     DateTime         @default(now()) @db.Date
  ServiceRequest ServiceRequest[]
}

model ServiceRequest {
  request_id   Int       @id @default(autoincrement())
  assigned_id  Employee? @relation(fields: [employee_id], references: [id])
  employee_id  Int?
  request_date DateTime  @default(now()) @db.Date
  status       String
  comments     String?
  urgency      Int
  location     Int
  service      String
}

model Directory {
  directory_id  Int            @id @default(autoincrement())
  service       String
  opening_hours OpeningHours[] // Some services have multiple different opening hours
  specialty     String
  location      Location[]
  telephone     String
}

model OpeningHours {
  fk_directory      Directory @relation(fields: [directory_id], references: [directory_id])
  directory_id      Int
  start_day         String // Needs to have a CHECK constraint in DB (cant be done in prisma) Only Days Sunday-Saturday valid
  end_day           String // Needs to have a CHECK constraint in DB (cant be done in prisma) Only Days Sunday-Saturday valid
  open_time         DateTime  @db.Time()
  close_time        DateTime  @db.Time()
  excludes_holidays Boolean

  @@id([directory_id, start_day, end_day])
}

model Location {
  fk_directory Directory @relation(fields: [directory_id], references: [directory_id])
  directory_id Int
  floor        Int
  suite        String

  @@id([floor, suite])
}
